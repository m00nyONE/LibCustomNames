name: Tests (Platform)
on:
  workflow_call:
    inputs:
      NAMES_PATH:
        required: true
        type: string
jobs:
  syntax-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Check for syntax errors in Lua files
        run: |
          URL=$(curl -s https://api.github.com/repos/EmmyLuaLs/emmylua-analyzer-rust/releases/latest | jq -r '.assets[] | select(.name? | match("emmylua_check-linux-x64.tar.gz$")) | .browser_download_url')
          if [ -n "$URL" ]; then
            curl -L "$URL" -o emmylua_check-linux-x64.tar.gz
          else
            echo "::error:: ‚ùå File not found in latest release."
            exit 1
          fi

          tar -xzf emmylua_check-linux-x64.tar.gz
          chmod +x emmylua_check

          ./emmylua_check ${{ inputs.NAMES_PATH }}
  check-duplicates:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check for duplicate definitions
        run: python3 .github/scripts/tests/check-duplicates.py ${{ inputs.NAMES_PATH }}
  check-color-formatting:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check for correct formatting of colored name strings
        run: python3 .github/scripts/tests/check-color-formatting.py ${{ inputs.NAMES_PATH }}